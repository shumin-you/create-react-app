<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‚¨çš„ä½ç¢³æ—…éŠæŒ‡æ•¸å¿ƒç†æ¸¬é©—</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®šå­—é«”ç‚º Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="antialiased">

    <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="text-center mb-10 bg-white p-6 rounded-xl shadow-lg">
            <h1 class="text-4xl font-extrabold text-teal-600 mb-2">ğŸŒ± ä½ç¢³æ—…éŠæŒ‡æ•¸å¿ƒç†æ¸¬é©—</h1>
            <p class="text-gray-600 text-lg">é€é 10 å€‹æ—…éŠæƒ…å¢ƒï¼Œäº†è§£æ‚¨çš„ç¶ è‰²æ—…è¡Œæ½›åŠ›ï¼</p>
        </header>

        <!-- User Info Input Fields (æ–°å¢çš„è³‡æ–™å€å¡Š) -->
        <div id="user-info-container" class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-600 mb-8 space-y-4 transition-all duration-300">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âœï¸ è«‹å¡«å¯«åŸºæœ¬è³‡æ–™ (å¿…å¡«)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- ç­ç´š -->
                <div>
                    <label for="user-class" class="block text-sm font-medium text-gray-700">ç­ç´š</label>
                    <input type="text" id="user-class" placeholder="ä¾‹å¦‚ï¼šäºŒå¹´ä¸™ç­"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-teal-500 focus:ring-teal-500">
                </div>
                <!-- åº§è™Ÿ -->
                <div>
                    <label for="user-seat" class="block text-sm font-medium text-gray-700">åº§è™Ÿ</label>
                    <input type="number" id="user-seat" placeholder="ä¾‹å¦‚ï¼š08"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-teal-500 focus:ring-teal-500">
                </div>
                <!-- å§“å -->
                <div>
                    <label for="user-name" class="block text-sm font-medium text-gray-700">å§“å</label>
                    <input type="text" id="user-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-teal-500 focus:ring-teal-500">
                </div>
            </div>
        </div>
        <!-- Quiz Container -->
        <div id="quiz-container" class="space-y-8">
            <!-- Questions will be dynamically inserted here -->
        </div>

        <!-- Submit Button -->
        <div class="mt-12 text-center">
            <button id="calculate-btn"
                    class="w-full sm:w-auto px-12 py-4 bg-green-600 text-white text-xl font-bold rounded-xl shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-[1.02] disabled:opacity-50">
                è¨ˆç®—æˆ‘çš„æŒ‡æ•¸
            </button>
        </div>

        <!-- Result Display -->
        <div id="result-display" class="mt-12 hidden">
            <div class="bg-white p-8 rounded-xl shadow-2xl border-t-8 border-teal-500">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">âœ¨ æ‚¨çš„æ¸¬é©—çµæœ</h2>
                <div id="result-score" class="text-2xl font-semibold mb-6 text-green-700"></div>

                <div id="result-type" class="text-4xl font-extrabold mb-4"></div>

                <div id="result-mindset" class="mb-6 border-l-4 border-teal-400 pl-4 py-2 bg-teal-50 text-gray-700">
                    <p class="font-bold">æ‚¨çš„å¿ƒæ…‹ï¼š</p>
                    <p id="mindset-text" class="mt-1"></p>
                </div>

                <div id="result-suggestion" class="text-gray-800">
                    <p class="font-bold text-xl text-green-600 mb-2">ğŸ’¡ å»ºè­°ï¼š</p>
                    <p id="suggestion-text"></p>
                </div>
                
                <button onclick="resetQuiz()" class="mt-8 px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">
                    é‡æ–°æ¸¬é©—
                </button>
            </div>
        </div>
        
        <!-- Instruction/Message Box (for alerts) -->
        <div id="message-box" class="fixed bottom-4 right-4 p-4 bg-red-500 text-white rounded-lg shadow-xl z-50 transition-transform duration-300 transform translate-x-full hidden">
            è«‹å®Œæˆæ‰€æœ‰é¡Œç›®ï¼
        </div>

    </div>

<script type="module">
    // Firebase æ¨¡çµ„å°å…¥
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global Firebase vars
    let db, auth, userId;

    // å®šç¾©æ¸¬é©—è³‡æ–™ï¼šé¡Œç›®ã€é¸é …æ–‡å­—å’Œå°æ‡‰çš„åˆ†æ•¸
    const quizData = [
        {
            id: 1,
            question: "è¦åŠƒä¸€è¶Ÿ 300 å…¬é‡Œå·¦å³çš„çŸ­é€”æ—…è¡Œï¼Œæ‚¨æœƒé¸æ“‡å“ªç¨®äº¤é€šå·¥å…·ï¼Ÿ",
            options: [
                { text: "æ­ä¹˜ç«è»Šæˆ–é«˜éµ", score: 4 },
                { text: "è‡ªå·±é–‹è»Šæˆ–æ­ä¹˜é£›æ©Ÿ", score: 1 },
                { text: "é¸æ“‡é•·é€”å·´å£«", score: 3 },
                { text: "é¸æ“‡ç§äººæ±½è»Šï¼Œä½†æœƒæ‰¾äººå…±ä¹˜", score: 2 }
            ]
        },
        {
            id: 2,
            question: "é¸æ“‡ä½å®¿æ™‚ï¼Œæ‚¨æœ€å„ªå…ˆè€ƒæ…®çš„æ˜¯ï¼Ÿ",
            options: [
                { text: "åœ‹éš›é€£é–äº”æ˜Ÿç´šé£¯åº—ï¼Œäº«å—å®Œå–„è¨­æ–½", score: 1 },
                { text: "å…·æœ‰ç•¶åœ°ç‰¹è‰²ã€ä¸”ç²å¾—ç’°ä¿èªè­‰çš„æ°‘å®¿æˆ–æ—…åº—", score: 4 },
                { text: "åƒ¹æ ¼é©ä¸­çš„ä¸­ç­‰é£¯åº—ï¼Œä¸ç‰¹åˆ¥è€ƒæ…®ç’°ä¿æ¨™ç« ", score: 2 },
                { text: "é¸æ“‡é’å¹´æ—…é¤¨æˆ–éœ²ç‡Ÿï¼Œä»¥æ¸›å°‘è³‡æºæ¶ˆè€—", score: 3 }
            ]
        },
        {
            id: 3,
            question: "æº–å‚™è¡Œææ™‚ï¼Œæ‚¨å°æ–¼ã€Œè¼•ä¾¿ã€çš„çœ‹æ³•æ˜¯ï¼Ÿ",
            options: [
                { text: "ç›¡å¯èƒ½å°‘å¸¶ï¼Œåªå¸¶æ‰‹æè¡Œæä¸Šæ©Ÿ/ä¸Šè»Š", score: 4 },
                { text: "å¸¶ä¸€å€‹æ¨™æº–å°ºå¯¸çš„è¡Œæç®±ï¼Œè£æ»¿æ‰€æœ‰éœ€è¦çš„æ±è¥¿", score: 2 },
                { text: "å¸¶å¤šå€‹å¤§åŒ…å°åŒ…ï¼Œä»¥å‚™ä¸æ™‚ä¹‹éœ€", score: 1 },
                { text: "åªå¸¶å¿…éœ€å“ï¼Œæ‰“ç®—åˆ°ç›®çš„åœ°å†è³¼è²·å…¶ä»–æ—¥å¸¸ç”¨å“", score: 3 }
            ]
        },
        {
            id: 4,
            question: "æ—…éŠæœŸé–“çš„é£²é£Ÿé¸æ“‡ï¼Œæ‚¨æœƒå‚¾å‘æ–¼ï¼Ÿ",
            options: [
                { text: "å„ªå…ˆå°‹æ‰¾ç•¶åœ°ç•¶å­£çš„è”¬é£Ÿæˆ–ç‰¹è‰²ç¾é£Ÿ", score: 4 },
                { text: "å°ˆæŒ‘è‡ªå·±ç†Ÿæ‚‰çš„è¥¿å¼é€Ÿé£Ÿæˆ–é€£é–é¤å»³", score: 1 },
                { text: "å˜—è©¦ç•¶åœ°æ–™ç†ï¼Œä½†æœƒä»¥è‚‰é¡æˆ–æµ·é®®å¤§é¤ç‚ºä¸»", score: 2 },
                { text: "è‡ªå‚™ç’°ä¿é¤å…·å’Œæ°´ç“¶ï¼Œç›¡é‡æ¸›å°‘å¤–å¸¶åƒåœ¾", score: 3 }
            ]
        },
        {
            id: 5,
            question: "é£¯åº—æˆ¿é–“å…§ï¼Œæ‚¨å°æ–¼æ°´é›»å’Œå‚™å“çš„ä½¿ç”¨æ…‹åº¦æ˜¯ï¼Ÿ",
            options: [
                { text: "æ—¢ç„¶ä»˜äº†éŒ¢ï¼Œå°±ç›¡æƒ…ä½¿ç”¨æ‰€æœ‰æä¾›çš„è³‡æº", score: 1 },
                { text: "æœƒé‡è¤‡ä½¿ç”¨æ¯›å·¾ï¼Œä¸¦åœ¨é›¢é–‹æˆ¿é–“æ™‚ç¢ºä¿é—œç‡ˆ/å†·æ°£", score: 4 },
                { text: "åªæœƒç¯€ç´„ç”¨æ°´ï¼Œå°ç¯€é›»ä¸å¤ªåœ¨æ„", score: 2 },
                { text: "æœƒè‡ªå‚™æ‰€æœ‰ç›¥æ´—ç”¨å“ï¼Œä»¥æ¸›å°‘ä¸€æ¬¡æ€§å¡‘è† çš„ä½¿ç”¨", score: 3 }
            ]
        },
        {
            id: 6,
            question: "åœ¨æ—…é€”ä¸­è£½é€ çš„åƒåœ¾ï¼ˆå¦‚é£²æ–™ç“¶ã€åŒ…è£ï¼‰å¦‚ä½•è™•ç†ï¼Ÿ",
            options: [
                { text: "å…¨éƒ¨ä¸Ÿé€²ä¸€èˆ¬åƒåœ¾æ¡¶ï¼Œåæ­£æœ‰äººæœƒè™•ç†", score: 1 },
                { text: "ä»”ç´°åˆ†é¡ï¼Œä¸¦æ‰¾åˆ°é©ç•¶çš„å›æ”¶ç®±", score: 4 },
                { text: "ä½¿ç”¨å¯é‡è¤‡åˆ©ç”¨çš„æ°´ç“¶å’Œæ¯å­ï¼Œä½†å…¶ä»–åƒåœ¾éš¨æ„ä¸Ÿæ£„", score: 3 },
                { text: "åªæœ‰çœ‹åˆ°æ˜é¡¯çš„å›æ”¶æ¡¶æ™‚æ‰æœƒè©¦è‘—å›æ”¶", score: 2 }
            ]
        },
        {
            id: 7,
            question: "é¸æ“‡æ—…éŠç´€å¿µå“æ™‚ï¼Œæ‚¨æœƒè€ƒæ…®ä»€éº¼ï¼Ÿ",
            options: [
                { text: "è³¼è²·å¤§é‡ç”Ÿç”¢çš„æ¨™æº–æ—…éŠç´€å¿µå“", score: 1 },
                { text: "è³¼è²·ç•¶åœ°è—è¡“å®¶çš„æ‰‹å·¥è—å“æˆ–ç’°ä¿ææ–™è£½æˆçš„ç”¢å“", score: 4 },
                { text: "æ”¶é›†ç•¶åœ°çš„è‡ªç„¶ç‰©ï¼ˆä¾‹å¦‚è²æ®¼ã€çŸ³é ­ï¼Œåœ¨å…è¨±çš„æƒ…æ³ä¸‹ï¼‰", score: 2 },
                { text: "é€éæ”å½±è¨˜éŒ„ç¾å¥½å›æ†¶ï¼Œä¸è²·ä»»ä½•å¯¦é«”ç´€å¿µå“", score: 3 }
            ]
        },
        {
            id: 8,
            question: "è¦åŠƒè¡Œç¨‹çš„ç¯€å¥ï¼Œæ‚¨å‚¾å‘æ–¼ï¼Ÿ",
            options: [
                { text: "ç›¡å¯èƒ½å®‰æ’æœ€å¤šæ™¯é»ï¼Œå……åˆ†åˆ©ç”¨æ™‚é–“", score: 1 },
                { text: "é¸æ“‡å°‘æ•¸å¹¾å€‹ç›®çš„åœ°ï¼Œæ·±å…¥é«”é©—ç•¶åœ°ç”Ÿæ´»", score: 4 },
                { text: "åš´æ ¼éµå¾ªæ—…è¡Œç¤¾æˆ–æ—¢å®šçš„è§€å…‰è·¯ç·š", score: 2 },
                { text: "æ¯å¤©éš¨å¿ƒæ‰€æ¬²åœ°æ±ºå®šè¦å»å“ªè£¡", score: 3 }
            ]
        },
        {
            id: 9,
            question: "é‡åˆ°éœ€è¦çˆ¬æ¨“æ¢¯æˆ–èµ°ä¸€å°æ®µè·¯çš„æƒ…æ³ï¼Œæ‚¨çš„åæ‡‰æ˜¯ï¼Ÿ",
            options: [
                { text: "å …æŒæ‰¾é›»æ¢¯æˆ–é›»å‹•æ­¥é“", score: 1 },
                { text: "æ¨‚æ„é¸æ“‡çˆ¬æ¨“æ¢¯ï¼Œè¦–ç‚ºé‹å‹•å’Œç¯€èƒ½", score: 4 },
                { text: "çœ‹çœ‹å…¶ä»–äººæ€éº¼åšï¼Œå†æ±ºå®š", score: 2 },
                { text: "å¦‚æœè¡Œæä¸é‡ï¼Œå°±æœƒé¸æ“‡èµ°æ¨“æ¢¯", score: 3 }
            ]
        },
        {
            id: 10,
            question: "æ—…ç¨‹çµæŸå¾Œï¼Œæ‚¨åˆ†äº«æ—…éŠç¶“æ­·æ™‚çš„é‡é»æ˜¯ï¼Ÿ",
            options: [
                { text: "åˆ†äº«è‡ªå·±äº«å—çš„è±ªè¯è¨­æ–½å’Œç¾é£Ÿ", score: 1 },
                { text: "åˆ†äº«ç•¶åœ°ä¿è‚²è¡Œå‹•ã€ç’°ä¿é¸æ“‡å’Œä½ç¢³ç¶“é©—", score: 4 },
                { text: "åªæ˜¯åˆ†äº«å»äº†å“ªäº›åœ°æ–¹ã€æ‹äº†å“ªäº›ç¾ç…§", score: 2 },
                { text: "è¦åŠƒä¸‹ä¸€æ¬¡å»æ›´åé ã€äººè·¡ç½•è‡³çš„åœ°æ–¹æ—…è¡Œ", score: 3 }
            ]
        }
    ];

    // çµæœåˆ†æè³‡æ–™
    const results = {
        A: {
            title: "é¡å‹ Aï¼šä½ç¢³æ—…è¡Œå®¶",
            range: "35 - 40åˆ†",
            color: "text-green-600",
            mindset: "æ‚¨æ˜¯ä½ç¢³æ—…éŠçš„å…ˆé©…è€…ï¼Œå…·å‚™é«˜åº¦çš„ç’°å¢ƒæ„è­˜ï¼Œä¸¦å°‡æ°¸çºŒåŸå‰‡èå…¥æ—…éŠçš„æ¯ä¸€å€‹ç’°ç¯€ã€‚æ‚¨ä¸åƒ…ç‚ºè‡ªå·±æ¸›å°‘ç¢³è¶³è·¡ï¼Œä¹Ÿç©æ¥µå½±éŸ¿èº«é‚Šçš„äººã€‚æ‚¨çš„æ¯ä¸€æ¬¡æ—…è¡Œéƒ½æ˜¯ä¸€æ¬¡å°åœ°çƒçš„æº«å’Œæ‰¿è«¾ã€‚",
            suggestion: "ç¹¼çºŒæ¢ç´¢æ–°çš„ç¶ è‰²ç§‘æŠ€å’Œæ–¹æ³•ï¼Œè€ƒæ…®åˆ†äº«æ‚¨çš„ç¶ è‰²æ—…éŠç¶“é©—ï¼Œæˆç‚ºç¤¾ç¾¤çš„é ˜å°è€…ã€‚"
        },
        B: {
            title: "é¡å‹ Bï¼šç¶ è‰²æ¢ç´¢è€…",
            range: "25 - 34åˆ†",
            color: "text-blue-600",
            mindset: "æ‚¨æ˜¯ä¸€ä½æœ‰æ„è­˜çš„æ¢éšªå®¶ã€‚æ‚¨æ¨‚æ–¼å˜—è©¦ä¸¦æ¥å—ä½ç¢³æ—…éŠçš„ç†å¿µï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å¢ƒä¸‹éƒ½èƒ½åšå‡ºç’°ä¿çš„é¸æ“‡ã€‚æ‚¨å·²ç¶“å…·å‚™è‰¯å¥½çš„ç’°ä¿ç¿’æ…£ï¼Œä½†å¶çˆ¾ä»æœƒå—åˆ°ä¾¿åˆ©æ€§æˆ–å‚³çµ±ç¿’æ…£çš„å½±éŸ¿ã€‚",
            suggestion: "è©¦è‘—å°‡ã€Œæ…¢æ´»ã€å“²å­¸å¸¶å…¥è¡Œç¨‹è¦åŠƒä¸­ï¼Œæ¸›å°‘è½‰æ›äº¤é€šå·¥å…·çš„é »ç‡ï¼Œä¸¦æ·±å…¥äº†è§£æ‚¨æ‰€é¸æ“‡çš„ç¶ è‰²æ—…é¤¨/å“ç‰Œçš„èƒŒå¾Œæ•…äº‹ã€‚"
        },
        C: {
            title: "é¡å‹ Cï¼šæ½›åŠ›ç¶ éŠå®¢",
            range: "15 - 24åˆ†",
            color: "text-yellow-600",
            mindset: "æ‚¨å°ä½ç¢³æ—…éŠçš„æ¦‚å¿µæœ‰æ‰€è€³èï¼Œä½†åœ¨å¯¦éš›æ“ä½œä¸­ï¼Œå¾€å¾€å„ªå…ˆè€ƒæ…®æ—…éŠçš„èˆ’é©åº¦å’Œä¾¿åˆ©æ€§ã€‚æ‚¨æœ‰æˆç‚ºç¶ è‰²æ—…è¡Œå®¶çš„æ½›åŠ›ï¼Œåªéœ€æ›´æ˜ç¢ºåœ°å°‡ç’°ä¿æ„è­˜è½‰åŒ–ç‚ºè¡Œå‹•ã€‚",
            suggestion: "å¾æœ€å®¹æ˜“å¯¦è¸çš„éƒ¨åˆ†é–‹å§‹ï¼Œä¾‹å¦‚ï¼šå…¨ç¨‹è‡ªå‚™æ°´ç“¶å’Œé¤å…·ï¼Œæˆ–æ˜¯é¸æ“‡åœ¨æ—…é€”ä¸­æ­ä¹˜ä¸€æ¬¡å¤§çœ¾é‹è¼¸å·¥å…·ã€‚å¾å°è™•è‘—æ‰‹ï¼Œç©å°‘æˆå¤šã€‚"
        },
        D: {
            title: "é¡å‹ Dï¼šå‚³çµ±è§€å…‰å®¢",
            range: "10 - 14åˆ†",
            color: "text-red-600",
            mindset: "æ‚¨ç›®å‰ä»æ˜¯æ¯”è¼ƒæ³¨é‡å‚³çµ±æ—…éŠé«”é©—çš„è§€å…‰å®¢ã€‚æ‚¨å¯èƒ½å°šæœªæ„è­˜åˆ°å€‹äººæ—…éŠé¸æ“‡å°ç’°å¢ƒçš„å½±éŸ¿ï¼Œæˆ–å°šæœªæ‰¾åˆ°å°‡ç’°ä¿èå…¥æ—…éŠçš„æ–¹æ³•ã€‚æ‚¨çš„é¸æ“‡å¾€å¾€ä»¥æ•ˆç‡å’Œå€‹äººäº«å—ç‚ºå„ªå…ˆã€‚",
            suggestion: "å˜—è©¦é–±è®€é—œæ–¼æ°£å€™è®Šé·èˆ‡æ—…éŠå½±éŸ¿çš„è³‡è¨Šã€‚ä¸‹æ¬¡æ—…è¡Œæ™‚ï¼Œè©¦è‘—æŒ‘æˆ°è‡ªå·±åªé¸æ“‡ä¸€å€‹ã€Œä½ç¢³ã€è¡Œç‚ºï¼Œä¾‹å¦‚ï¼šåœ¨ç•¶åœ°å¸‚å ´è³¼è²·é£Ÿç‰©ä»¥æ¸›å°‘é£Ÿç‰©é‡Œç¨‹ã€‚æ¯é‚å‡ºä¸€å°æ­¥ï¼Œéƒ½æ˜¯å°åœ°çƒçš„ä¸€å¤§è²¢ç»ã€‚"
        }
    };

    const quizContainer = document.getElementById('quiz-container');
    const calculateBtn = document.getElementById('calculate-btn');
    const resultDisplay = document.getElementById('result-display');
    const messageBox = document.getElementById('message-box');
    const userInfoContainer = document.getElementById('user-info-container'); // æ–°å¢

    // 1. Firebase åˆå§‹åŒ–èˆ‡ç™»å…¥
    async function initFirebase() {
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        if (Object.keys(firebaseConfig).length === 0) {
            console.error("Firebase configuration is missing.");
            showMessage("è³‡æ–™åº«è¨­å®šéºå¤±ï¼Œåˆ†æ•¸ç„¡æ³•å„²å­˜ã€‚", 'bg-red-500');
            return;
        }

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            setLogLevel('Debug'); // é–‹å•Ÿ Firebase åµéŒ¯æ—¥èªŒ

            // ç™»å…¥
            if (typeof __initial_auth_token !== 'undefined') {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
            // å–å¾—ä½¿ç”¨è€…IDï¼Œæœªç™»å…¥å‰‡ä½¿ç”¨éš¨æ©ŸID
            userId = auth.currentUser?.uid || crypto.randomUUID();
            console.log("Firebase initialized. User ID:", userId);
            
            // è¼‰å…¥æ¸¬é©—ä¸¦ç¶å®šäº‹ä»¶
            renderQuiz();
            calculateBtn.addEventListener('click', calculateScore);

        } catch (error) {
            console.error("Firebase Initialization or Auth Error:", error);
            showMessage("è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œåˆ†æ•¸ç„¡æ³•å„²å­˜ã€‚", 'bg-red-500');
        }
    }

    // 2. å„²å­˜çµæœåˆ° Firestore
    async function saveResultToFirestore(score, resultTypeTitle) {
        if (!db || !userId) {
            console.error("Database not ready or User ID missing.");
            showMessage("ç„¡æ³•å„²å­˜çµæœï¼Œè«‹æª¢æŸ¥é€£ç·šã€‚", 'bg-red-500');
            return;
        }

        const userNameInput = document.getElementById('user-name').value.trim();
        const userClassInput = document.getElementById('user-class').value.trim();
        const userSeatInput = document.getElementById('user-seat').value.trim();


        // ä½¿ç”¨ public è·¯å¾‘è®“å…¶ä»–äººå¯ä»¥çœ‹åˆ°çµæœ
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const collectionPath = `artifacts/${appId}/public/data/quiz_results`;

        const resultData = {
            userId: userId,
            score: score,
            resultType: resultTypeTitle,
            timestamp: serverTimestamp(), // è¨˜éŒ„å„²å­˜æ™‚é–“
            userName: userNameInput,       // å„²å­˜å§“å
            userClass: userClassInput,     // å„²å­˜ç­ç´š
            userSeat: userSeatInput,       // å„²å­˜åº§è™Ÿ
        };

        try {
            const docRef = await addDoc(collection(db, collectionPath), resultData);
            showMessage(`åˆ†æ•¸å·²å„²å­˜ï¼è¨˜éŒ„ID: ${docRef.id.substring(0, 4)}`, 'bg-green-600');
        } catch (e) {
            console.error("Error adding document: ", e);
            showMessage("å„²å­˜åˆ†æ•¸æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚", 'bg-red-500');
        }
    }

    // 3. æ¸²æŸ“æ¸¬é©—é¡Œç›®åˆ°ç¶²é ä¸Š
    function renderQuiz() {
        quizData.forEach(q => {
            const questionCard = document.createElement('div');
            questionCard.className = 'bg-white p-6 rounded-xl shadow-lg border-l-4 border-teal-500';
            
            const questionTitle = document.createElement('h3');
            questionTitle.className = 'text-xl font-semibold text-gray-800 mb-4';
            questionTitle.textContent = `${q.id}. ${q.question}`;
            questionCard.appendChild(questionTitle);

            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'space-y-3';

            q.options.forEach((option, index) => {
                const label = document.createElement('label');
                label.className = 'flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-teal-50 transition duration-150';
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question-${q.id}`;
                input.value = option.score; // å„²å­˜åˆ†æ•¸
                input.className = 'h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 transform scale-110';
                
                // è®“é»æ“Šæ¨™ç±¤çš„ä»»ä½•åœ°æ–¹éƒ½èƒ½è§¸ç™¼é¸æ“‡
                label.onclick = function() {
                    input.checked = true;
                    // å¢åŠ é¸ä¸­æ™‚çš„è¦–è¦ºå›é¥‹
                    document.querySelectorAll(`input[name="question-${q.id}"]`).forEach(radio => {
                        radio.parentElement.classList.remove('bg-teal-100', 'ring-2', 'ring-teal-500');
                    });
                    this.classList.add('bg-teal-100', 'ring-2', 'ring-teal-500');
                };

                const span = document.createElement('span');
                span.className = 'ml-3 text-base text-gray-700 font-medium';
                span.textContent = option.text;
                
                label.appendChild(input);
                label.appendChild(span);
                optionsContainer.appendChild(label);
            });

            questionCard.appendChild(optionsContainer);
            quizContainer.appendChild(questionCard);
        });
    }

    // 4. è¨ˆç®—åˆ†æ•¸ä¸¦é¡¯ç¤ºçµæœ (æ–°å¢äº†è³‡æ–™æª¢æŸ¥)
    function calculateScore() {
        let totalScore = 0;
        let allAnswered = true;

        // æª¢æŸ¥åŸºæœ¬è³‡æ–™æ˜¯å¦å¡«å¯«
        const userNameInput = document.getElementById('user-name').value.trim();
        const userClassInput = document.getElementById('user-class').value.trim();
        const userSeatInput = document.getElementById('user-seat').value.trim();

        if (userNameInput === "" || userClassInput === "" || userSeatInput === "") {
            showMessage("è«‹å¡«å¯«ç­ç´šã€åº§è™Ÿå’Œå§“åï¼", 'bg-yellow-600');
            // æ¨™è¨˜åŸºæœ¬è³‡æ–™å€å¡Š
            userInfoContainer.classList.add('border-red-500', 'ring-2', 'ring-red-500');
            userInfoContainer.scrollIntoView({ behavior: 'smooth' });
            return;
        } else {
            userInfoContainer.classList.remove('border-red-500', 'ring-2', 'ring-red-500');
        }
        
        // æª¢æŸ¥å•å·é¡Œç›®æ˜¯å¦å¡«å¯«
        quizData.forEach(q => {
            const selector = `input[name="question-${q.id}"]:checked`;
            const selectedOption = document.querySelector(selector);
            
            // ç§»é™¤èˆŠçš„ç´…è‰²é‚Šæ¡†
            const questionCard = document.querySelector(`#quiz-container > div:nth-child(${q.id})`);
            questionCard.classList.remove('border-red-500', 'border-l-4');
            questionCard.classList.add('border-teal-500', 'border-l-4');


            if (selectedOption) {
                totalScore += parseInt(selectedOption.value);
            } else {
                allAnswered = false;
                // æ¨™è¨˜æœªå›ç­”çš„é¡Œç›®
                questionCard.classList.remove('border-teal-500');
                questionCard.classList.add('border-red-500');
            }
        });

        if (!allAnswered) {
            showMessage("è«‹å®Œæˆæ‰€æœ‰é¡Œç›®æ‰èƒ½è¨ˆç®—åˆ†æ•¸ï¼", 'bg-red-500');
            // æ»¾å‹•åˆ°ç¬¬ä¸€å€‹æœªå›ç­”çš„é¡Œç›®
            document.querySelector('.border-red-500').scrollIntoView({ behavior: 'smooth' });
            return;
        }

        displayResult(totalScore);
    }

    // 5. æ ¹æ“šåˆ†æ•¸é¡¯ç¤ºå°æ‡‰çš„åˆ†æçµæœ 
    function displayResult(score) {
        let resultType;
        if (score >= 35) {
            resultType = results.A;
        } else if (score >= 25) {
            resultType = results.B;
        } else if (score >= 15) {
            resultType = results.C;
        } else {
            resultType = results.D;
        }

        // éš±è—æ¸¬é©—ï¼Œé¡¯ç¤ºçµæœ
        userInfoContainer.classList.add('hidden'); // éš±è—å€‹äººè³‡æ–™å€
        quizContainer.classList.add('hidden');
        calculateBtn.classList.add('hidden');
        resultDisplay.classList.remove('hidden');

        // æ›´æ–°çµæœå…§å®¹
        document.getElementById('result-score').textContent = `æ‚¨çš„ç¸½åˆ†ç‚ºï¼š${score} åˆ† (ç¸½åˆ†ç¯„åœ: ${resultType.range})`;
        
        const resultTypeEl = document.getElementById('result-type');
        resultTypeEl.className = `text-4xl font-extrabold mb-4 ${resultType.color}`;
        resultTypeEl.textContent = resultType.title;

        document.getElementById('mindset-text').textContent = resultType.mindset;
        document.getElementById('suggestion-text').textContent = resultType.suggestion;

        // å‘¼å«å„²å­˜çµæœåˆ° Firestore
        saveResultToFirestore(score, resultType.title); 

        // æ»¾å‹•åˆ°çµæœå€åŸŸ
        resultDisplay.scrollIntoView({ behavior: 'smooth' });
    }

    // 6. é‡è¨­æ¸¬é©—
    window.resetQuiz = function() {
        userInfoContainer.classList.remove('hidden'); // é¡¯ç¤ºå€‹äººè³‡æ–™å€
        quizContainer.classList.remove('hidden');
        calculateBtn.classList.remove('hidden');
        resultDisplay.classList.add('hidden');

        // æ¸…é™¤å€‹äººè³‡æ–™æ¬„ä½
        document.getElementById('user-name').value = '';
        document.getElementById('user-class').value = '';
        document.getElementById('user-seat').value = '';
        userInfoContainer.classList.remove('border-red-500', 'ring-2', 'ring-red-500');

        // æ¸…é™¤æ‰€æœ‰é¸ä¸­çš„é¸é …
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.checked = false;
            radio.parentElement.classList.remove('bg-teal-100', 'ring-2', 'ring-teal-500');
        });
        // æ¸…é™¤æœªå›ç­”çš„é¡Œç›®æ¨™è¨˜
        document.querySelectorAll('.border-red-500').forEach(card => {
            card.classList.remove('border-red-500');
            card.classList.add('border-teal-500');
        });

        // æ»¾å‹•åˆ°é ‚éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // 7. è¨Šæ¯æç¤ºæ¡† (å–ä»£ alert) 
    function showMessage(msg, colorClass) {
        messageBox.textContent = msg;
        messageBox.className = `fixed bottom-4 right-4 p-4 text-white rounded-lg shadow-xl z-50 transition-transform duration-300 transform translate-x-0`;
        messageBox.classList.remove('bg-red-500', 'bg-green-600', 'bg-blue-500', 'bg-yellow-600');
        messageBox.classList.add(colorClass);
        messageBox.classList.remove('hidden');

        setTimeout(() => {
            messageBox.classList.add('translate-x-full');
            // ä½¿ç”¨ setTimeout ç¢ºä¿å‹•ç•«å®Œæˆå¾Œå†éš±è—
            setTimeout(() => { messageBox.classList.add('hidden'); }, 300);
        }, 3000);
    }

    // åˆå§‹è¼‰å…¥ï¼šé–‹å§‹ Firebase åˆå§‹åŒ–
    initFirebase();

</script>

</body>
</html>
